<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CCS University Notices</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="alternate" type="application/rss+xml" title="CCS University Notices RSS" href="rss.xml">

<style>
body { margin:0; font-family:Arial,sans-serif; background:#f4f6f8 }
header { background:#0b3c5d; color:#fff; padding:18px; text-align:center }
main { max-width:1100px; margin:auto; padding:18px }
section { background:#fff; border-radius:6px; padding:18px; box-shadow:0 2px 8px rgba(0,0,0,.08) }
.notice { border-bottom:1px solid #e5e5e5; padding:12px 0 }
.notice:last-child { border-bottom:none }
.notice a { color:#0b3c5d; font-weight:bold; text-decoration:none }
.notice a:hover { text-decoration:underline }
.date { font-size:13px; color:#555 }
#error { color:red; text-align:center }
</style>
</head>

<body>

<header>
  <h1>Chaudhary Charan Singh University, Meerut:</h1>
  <p>Auto-updating official notifications</p>
</header>

<main>
<section>
  <h3>Latest Notices</h3>
  <div id="error"></div>
  <div id="newsList"></div>
</section>
</main>

<script>
const API_URL = "https://api.ccsuniversity.ac.in/news/search?title=&id=Notice&month=&year=&page=1";
let lastHash = "";

async function fetchNews() {
  try {
    const res = await fetch(API_URL);
    if (!res.ok) throw new Error("API error");
    const data = await res.json();

    const hash = JSON.stringify(data.news);
    if (hash === lastHash) return; // ðŸ”¥ prevents reload

    lastHash = hash;
    renderNews(data.news);

  } catch {
    document.getElementById("error").textContent =
      "Unable to fetch notices at the moment.";
  }
}

function renderNews(news) {
  const list = document.getElementById("newsList");
  list.innerHTML = "";

  if (!news || !news.length) {
    list.innerHTML = "<p>No notices available.</p>";
    return;
  }

  news.forEach(item => {
    const div = document.createElement("div");
    div.className = "notice";
    div.innerHTML = `
      <a href="${item.url}" target="_blank">${item.title}</a>
      <div class="date">${new Date(item.created_at).toDateString()}</div>
    `;
    list.appendChild(div);
  });
}

// single initial load
fetchNews();

// refresh every 60s WITHOUT reload
setInterval(fetchNews, 60000);
</script>

</body>
</html>
